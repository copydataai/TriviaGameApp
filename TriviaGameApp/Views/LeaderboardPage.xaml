<?xml version="1.0" encoding="utf-8" ?>
<ContentPage 
    x:Class="TriviaGameApp.Views.LeaderboardPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:models="clr-namespace:TriviaGameApp.Models">


    <!-- We wrap the whole page in an absolute layout so we can center the spinner easily -->
    <AbsoluteLayout>

        <!-- The main content of the page (filters + table) -->
        <ScrollView 
            x:Name="LeaderboardContainer"
            AbsoluteLayout.LayoutFlags="All"
            AbsoluteLayout.LayoutBounds="0,0,1,1"
            IsVisible="False"> <!-- hidden until user changes a filter -->

            <VerticalStackLayout Padding="20" Spacing="10">
                
                <!-- FILTER CONTROLS -->
                <HorizontalStackLayout Spacing="5" Margin="0,10,0,10">
                    <!-- Category picker -->
                    <Picker 
                        x:Name="CategoryFilterPicker"
                        Title="Filter by Category"
                        WidthRequest="180"/>
            
                    <!-- Difficulty picker -->
                    <Picker 
                        x:Name="DifficultyFilterPicker"
                        Title="Filter by Difficulty"
                        WidthRequest="150"/>

                    <!-- Name search -->
                    <VerticalStackLayout Spacing="0" VerticalOptions="Center">
                        <Label Text="Name" FontAttributes="Bold" VerticalOptions="Center"/>
                        <Entry 
                            x:Name="NameSearchEntry"
                            Placeholder="Filter by Name"
                            HeightRequest="40"
                            WidthRequest="120" />
                    </VerticalStackLayout>
                </HorizontalStackLayout>

                <!-- Table Header -->
                <Grid 
                    ColumnDefinitions="Auto,2*,1*,1*,1*,1*,1*,1*"
                    Padding="5,0" 
                    BackgroundColor="{AppThemeBinding Light=#EEEEEE, Dark=#222222}">
                    <Label Grid.Column="0" Text="Rank" FontAttributes="Bold" HorizontalOptions="Center"/>
                    <Label Grid.Column="1" Text="Name" FontAttributes="Bold" HorizontalOptions="Center"/>
                    <Label Grid.Column="2" Text="Category" FontAttributes="Bold" HorizontalOptions="Center"/>
                    <Label Grid.Column="3" Text="Difficulty" FontAttributes="Bold" HorizontalOptions="Center"/>
                    <Label Grid.Column="4" Text="Questions" FontAttributes="Bold" HorizontalOptions="Center"/>
                    <Label Grid.Column="5" Text="Time(s)" FontAttributes="Bold" HorizontalOptions="Center"/>
                    <Label Grid.Column="6" Text="Points" FontAttributes="Bold" HorizontalOptions="Center"/>
                    <Label Grid.Column="7" Text="Date" FontAttributes="Bold" HorizontalOptions="Center"/>
                </Grid>

                <!-- CollectionView for the leaderboard -->
                <CollectionView 
                    x:Name="LeaderboardCollectionView"
                    ItemsLayout="VerticalList">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:LeaderboardEntry">
                            <!-- A Border around each row for separation -->
                            <Border 
                                StrokeThickness="1"
                                Stroke="{AppThemeBinding Light=LightGray, Dark=Gray}"
                                Padding="10"
                                Margin="0,2">
                                <Grid ColumnDefinitions="Auto,2*,1*,1*,1*,1*,1*,1*" Padding="5,0">
                                    <HorizontalStackLayout Grid.Column="0" HorizontalOptions="Center">
                                        <Label Text="{Binding Rank}" Margin="0,0,5,0"/>
                                        <Label Text="{Binding MedalEmoji}" />
                                    </HorizontalStackLayout>
                                    <Label Grid.Column="1" Text="{Binding Name}" HorizontalOptions="Center"/>
                                    <Label Grid.Column="2" Text="{Binding Category}" HorizontalOptions="Center" />
                                    <Label Grid.Column="3" Text="{Binding Difficulty}" HorizontalOptions="Center"/>
                                    <Label Grid.Column="4" Text="{Binding Questions}" HorizontalOptions="Center"/>
                                    <Label Grid.Column="5" Text="{Binding TimeInSeconds}" HorizontalOptions="Center"/> 
                                    <Label Grid.Column="6" Text="{Binding TotalPoints}" HorizontalOptions="Center"/>
                                    <Label Grid.Column="7" Text="{Binding DateOfGame, StringFormat='{0:MM/dd/yyyy}'}" HorizontalOptions="Center"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Loading indicator + random text in the center -->
        <VerticalStackLayout
            x:Name="LoadingLayout"
            AbsoluteLayout.LayoutFlags="All"
            AbsoluteLayout.LayoutBounds="0.5,0.5,1,1"
            HorizontalOptions="Center"
            VerticalOptions="Center">

            <Label 
                x:Name="RandomLoadingLabel" 
                Text="Loading..."
                FontAttributes="Bold"
                HorizontalOptions="Center"
                IsVisible="False" />

            <ActivityIndicator 
                x:Name="LoadingIndicator"
                IsRunning="False"
                IsVisible="False"
                Color="{AppThemeBinding Light=Blue, Dark=Cyan}"
                HeightRequest="50" 
                HorizontalOptions="Center" 
                VerticalOptions="Center" />

        </VerticalStackLayout>

    </AbsoluteLayout>
</ContentPage>
